<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!-- Styles -->
<style>
#chartdiv {
  width: 100%;
  height: 500px;
}

</style>

<!-- Resources -->


<script src={{ url_for('static', filename='amcharts4/core.js') }}></script>
<script src={{ url_for('static', filename='amcharts4/charts.js') }}></script>
<script src={{ url_for('static', filename='amcharts4/maps.js') }}></script>

<script src={{ url_for('static', filename='amcharts4/themes/animated.js') }}></script>

<script src={{ url_for('static', filename='geodata/continentsLow.js') }}></script>
<script src={{ url_for('static', filename='geodata/worldLow.js') }}></script>




</head>

<body>



<!-- HTML -->
<div id="chartdiv" style="width: 100%; height: 100%"></div>
















<!-- Chart code -->
<script>
// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end

// Create map instance
var chart = am4core.create("chartdiv", am4maps.MapChart);

// Set map definition
chart.geodata = am4geodata_worldLow;

// Set projection
chart.projection = new am4maps.projections.Miller();

// Create map polygon series
var polygonSeries = chart.series.push(new am4maps.MapPolygonSeries());
polygonSeries.exclude = ["AQ"];;
polygonSeries.useGeodata = true;

var polygonTemplate = polygonSeries.mapPolygons.template;
polygonTemplate.tooltipText = "{name}";
polygonTemplate.fill = chart.colors.getIndex(0);

// Create hover state and set alternative fill color
var hs = polygonTemplate.states.create("hover");
hs.properties.fill = chart.colors.getIndex(0).brighten(-0.5);



// Create an image series that will hold pie charts
var pieSeries = chart.series.push(new am4maps.MapImageSeries());
var pieTemplate = pieSeries.mapImages.template;
pieTemplate.propertyFields.latitude = "latitude";
pieTemplate.propertyFields.longitude = "longitude";

var pieChartTemplate = pieTemplate.createChild(am4charts.PieChart);
pieChartTemplate.adapter.add("data", function(data, target) {
  if (target.dataItem) {
    return target.dataItem.dataContext.pieData;
  }
  else {
    return [];
  }
});
pieChartTemplate.propertyFields.width = "width";
pieChartTemplate.propertyFields.height = "height";
pieChartTemplate.horizontalCenter = "middle";
pieChartTemplate.verticalCenter = "middle";

var pieTitle = pieChartTemplate.titles.create();
pieTitle.text = "{title}";

var pieSeriesTemplate = pieChartTemplate.series.push(new am4charts.PieSeries);
pieSeriesTemplate.dataFields.category = "category";
pieSeriesTemplate.dataFields.value = "value";
pieSeriesTemplate.labels.template.disabled = true;
pieSeriesTemplate.ticks.template.disabled = true;



//timer loop
// setInterval(load_data, 3000);
//
//
// function load_data( )
// {
//   pieSeries.data = {{data_json|safe}}
// }
  pieSeries.data = {{data_json|safe}}

</script>

</body>
</html>